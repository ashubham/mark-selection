{"version":3,"file":"markee-es.js","sources":["../build/src/index.js"],"sourcesContent":["let defaultConfig = {\n    initialText: 'I am a sample text, you can highlight me!',\n    startIdx: 0,\n    endIdx: 1,\n    markerClass: 'marker',\n    tokenClass: 'token',\n    beginClass: 'begin',\n    endClass: 'end',\n    selectedClass: 'selected',\n    draggedClass: 'dragged',\n    hideDragGhost: false\n};\nexport class Markee {\n    constructor(el, config) {\n        this.el = el;\n        this.config = config;\n        this.config = Object.assign({}, defaultConfig, this.config);\n        this.createTokens();\n        this.initContainer();\n        this.initDragEvents();\n        this.initClickEvents();\n        this.updateSelectedChildren();\n    }\n    initContainer() {\n        this.el.style.display = 'flex';\n        this.el.style.userSelect = 'none';\n        this.begin = this.createMarker(true, this.config.startIdx * 2);\n        this.end = this.createMarker(false, this.config.endIdx * 2);\n        this.el.appendChild(this.begin.node);\n        this.el.appendChild(this.end.node);\n    }\n    createTokens() {\n        this.el.innerHTML = this.config.initialText\n            .split(' ')\n            .map((t, idx) => {\n            let order = idx * 2 + 1;\n            let selectedClass = (idx >= this.config.startIdx && idx < this.config.endIdx)\n                ? this.config.selectedClass : '';\n            return `<div class=\"${this.config.tokenClass} ${selectedClass}\" data-order=${order} style=\"order:${order}\">` +\n                `${t}</div>`;\n        })\n            .join('');\n    }\n    initDragEvents() {\n        this.el.addEventListener('dragstart', (e) => {\n            let target = e.target;\n            if (target.classList.contains(this.config.markerClass)) {\n                this.dragged = (target.id === this.config.beginClass) ? this.begin : this.end;\n                if (this.config.hideDragGhost) {\n                    target.style.opacity = '0';\n                    e.dataTransfer.setDragImage(target, 0, 0);\n                }\n                // Just to keep Firefox happy.\n                e.dataTransfer.setData('Text', 'random');\n                e.dataTransfer.setData(\"text/plain\", target.id);\n                setTimeout(() => {\n                    target.style.opacity = '1';\n                    target.classList.add(this.config.draggedClass);\n                });\n            }\n        });\n        this.el.addEventListener('dragenter', e => {\n            let target = e.target;\n            if (this.dragged && this.isToken(target)) {\n                let order = Number.parseInt(target.dataset.order);\n                if (this.dragged === this.begin && order + 1 <= this.end.order) {\n                    this.updateSelection(this.dragged, order - 1, target);\n                }\n                else if (this.dragged === this.end && order - 1 >= this.begin.order) {\n                    this.updateSelection(this.dragged, order + 1, target);\n                }\n            }\n        });\n        this.el.addEventListener('dragend', (e) => {\n            let target = e.target;\n            target.classList.remove(this.config.draggedClass);\n            this.dragged = null;\n        });\n    }\n    initClickEvents() {\n        this.el.addEventListener('click', (evt) => {\n            let target = evt.target;\n            if (this.isToken(target)) {\n                let order = Number.parseInt(target.dataset.order);\n                this.begin.order = order - 1;\n                this.begin.node.style.order = '' + this.begin.order;\n                this.end.order = order + 1;\n                this.end.node.style.order = '' + this.end.order;\n                this.updateSelectedChildren();\n            }\n        });\n    }\n    isToken(target) {\n        return target.classList.contains(this.config.tokenClass);\n    }\n    updateSelection(dragged, order, target) {\n        dragged.node.style.order = '' + order;\n        dragged.order = order;\n        this.updateSelectedChildren();\n    }\n    updateSelectedChildren() {\n        let selectedText = '';\n        let startIdx = this.begin.order / 2;\n        let endIdx = this.end.order / 2;\n        Array.from(this.el.children).forEach((child, idx) => {\n            if (idx >= startIdx && idx < endIdx) {\n                child.classList.add(this.config.selectedClass);\n                selectedText += ' ' + child.textContent;\n            }\n            else {\n                child.classList.remove(this.config.selectedClass);\n            }\n        });\n        this.config.onMarked(selectedText, startIdx, endIdx - 1, this.begin.node, this.end.node);\n    }\n    createMarker(isBegin = false, order) {\n        let container = document.createElement('div');\n        let id = (isBegin ? this.config.beginClass : this.config.endClass);\n        container.innerHTML = `<div draggable=true class=\"${this.config.markerClass} ${id}\"` +\n            ` id=${id} style=\"order:${order}\"></div>`;\n        let node = container.firstElementChild;\n        return {\n            node: node,\n            order: order,\n            isBegin: isBegin\n        };\n    }\n}\n//# sourceMappingURL=index.js.map"],"names":["defaultConfig","initialText","startIdx","endIdx","markerClass","tokenClass","beginClass","endClass","selectedClass","draggedClass","hideDragGhost","Markee","[object Object]","el","config","this","Object","assign","createTokens","initContainer","initDragEvents","initClickEvents","updateSelectedChildren","style","display","userSelect","begin","createMarker","end","appendChild","node","innerHTML","split","map","t","idx","order","join","addEventListener","e","target","classList","contains","dragged","id","opacity","dataTransfer","setDragImage","setData","setTimeout","add","isToken","Number","parseInt","dataset","updateSelection","remove","evt","selectedText","Array","from","children","forEach","child","textContent","onMarked","isBegin","container","document","createElement","firstElementChild"],"mappings":"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"}